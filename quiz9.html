<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Have / Has / Had — Interactive Quiz | Keynote Grammar</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#00172b; --bg2:#013a63;
    --yellow:#ffd24d;
    --muted:#cfe9ff;
    --card: rgba(255,255,255,0.04);
    --glass: rgba(255,255,255,0.06);
    --ok:#2ecc71; --bad:#ff6b6b;
    --choice-text-size: 1.18rem;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:"Poppins",sans-serif;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color:#eaf6ff;
    min-height:100vh;
    padding:28px;
    display:flex;
    justify-content:center;
    align-items:flex-start;
  }
  .wrap{width:100%;max-width:980px}
  .card{
    background:var(--card);
    border-radius:14px;
    padding:20px;
    border:1px solid rgba(255,255,255,0.08);
    backdrop-filter:blur(8px);
    box-shadow:0 14px 40px rgba(0,0,0,0.5);
  }

  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
  h1{color:var(--yellow);font-size:1.4rem}
  .meta{color:var(--muted);font-weight:600}

  #quizArea{margin-top:12px}
  .question-box{
    background:rgba(255,255,255,0.03);
    padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);
    margin-bottom:12px;
  }

  .qtext{font-size:1.25rem;margin-bottom:12px;color:#eaf6ff;min-height:3rem}
  .choices{display:flex;flex-wrap:wrap;gap:10px}
  .choice{
    background:var(--yellow);
    color:#001f2e;
    padding:14px 20px;
    border-radius:12px;
    cursor:pointer;
    font-weight:800;
    font-size:var(--choice-text-size);
    min-width:140px;
    text-align:center;
    border:2px solid rgba(0,0,0,0.08);
    transition:transform .12s, box-shadow .12s;
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  }
  .choice:hover{transform:translateY(-3px);box-shadow:0 14px 30px rgba(0,0,0,0.3)}
  .choice.disabled{pointer-events:none;opacity:0.6}
  .choice.correct{background:var(--ok);color:#002218}
  .choice.wrong{background:var(--bad);color:#fff}

  /* Larger answer text (applies to labels inside choice) */
  .choice .label{font-size:1.18rem;display:block;font-weight:800}

  /* Fill input */
  .fill-input input{
    width:100%;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.08);
    color:#001f2e;font-weight:700;font-size:1.05rem;
  }
  .fill-input { margin-top:8px }

  /* Sentence builder */
  .token-bank{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
  .token{
    background:var(--yellow);
    color:#000;
    padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:800;
    font-size:1rem; box-shadow:0 6px 18px rgba(0,0,0,0.2)
  }
  .token.used{opacity:0.45;pointer-events:none}
  .built{min-height:56px;background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;border:1px dashed rgba(255,255,255,0.06);display:flex;gap:8px;flex-wrap:wrap;align-items:center}

  .undo-btn{margin-top:10px;padding:8px 12px;border-radius:999px;border:none;background:#ffffff22;color:#fff;font-weight:700;cursor:pointer}

  /* Matching */
  .match-wrap{display:flex;gap:16px;flex-wrap:wrap;margin-top:12px}
  .match-col{flex:1;min-width:180px;background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
  .match-item{padding:10px;border-radius:8px;background:rgba(255,255,255,0.06);margin-bottom:8px;cursor:pointer;font-weight:700;color:#eaf6ff}
  .match-item.selected{outline:3px solid rgba(0,0,0,0.06);background:var(--yellow);color:#001f2e}
  .match-item.matched{background:var(--ok);color:#002218;pointer-events:none;opacity:0.9}

  .feedback{height:28px;margin-top:10px;font-weight:700}

  /* final */
  .final-score{font-size:2.6rem;color:var(--yellow);font-weight:900;text-align:center;margin-bottom:12px}
  .final-actions{display:flex;gap:12px;justify-content:center;margin-top:10px;flex-wrap:wrap}

  /* fireworks canvas */
  canvas#fw{position:fixed;left:0;top:0;pointer-events:none;display:none;z-index:9999}

  @media (max-width:720px){
    .choice{min-width:44%;font-size:1rem}
    .qtext{font-size:1.05rem}
    .token{font-size:0.95rem;padding:6px 10px}
  }
</style>
</head>
<body>
  <canvas id="fw"></canvas>

  <div class="wrap">
    <div class="card">
      <header>
        <div>
          <h1>Have • Has • Had — Interactive Quiz</h1>
          <div class="meta">20 questions · Auto-advance · Sounds · Fireworks at ≥ 75</div>
        </div>
        <div style="text-align:right">
          <div id="scoreLabel" style="font-weight:800;color:var(--yellow)">Score: 0</div>
          <div id="progressLabel" style="color:var(--muted);font-weight:700">Q 1 / 20</div>
        </div>
      </header>

      <div id="quizArea"></div>

      <div id="finalArea" style="display:none;margin-top:10px"></div>
    </div>
  </div>

<script>
/* --------------- SOUND --------------- */
/* Files should be in same folder as this HTML:
   rightclick.mp3  (correct)
   wrongclick.mp3  (wrong)
   bubble.mp3      (click)
   fireworks.mp3   (celebration)
*/
const S = {
  ok: new Audio('rightclick.mp3'),
  bad: new Audio('wrongclick.mp3'),
  click: new Audio('bubble.mp3'),
  fire: new Audio('fireworks.mp3')
};
function safePlay(a){
  try{ a.currentTime = 0; a.play().catch(()=>{}); } catch(e){}
}

/* --------------- QUESTIONS (keep your original structure) --------------- */
/* 20 items (5 MCQ, 5 builders, 5 match sets, 5 drag-to-fill) */
const QUESTIONS = [
  /* MCQ (5) */
  {type:'mcq', q:'I  ____ a lot of homework today. I need to do it now.', choices:['Have','Has','Had','Haves'], a:0},
  {type:'mcq', q:'She ____ two sisters.', choices:['Have','Has','Had','Having'], a:1},
  {type:'mcq', q:'They ____ a red car last year.', choices:['have','has','had','haves'], a:2},
  {type:'mcq', q:'I ____ no idea about it.', choices:['has','have','had','having'], a:1},
  {type:'mcq', q:'He ____ breakfast this morning.', choices:['have','has','had',"hasn't"], a:2},

  /* Sentence Builder (5) */
  {type:'builder', q:'(arrange) → ownership: He / a / bike / has', words:['He','has','a','bike'], answer:'He has a bike'},
  {type:'builder', q:'(arrange) → ownership (past): They / a / had / car', words:['They','had','a','car'], answer:'They had a car'},
  {type:'builder', q:'(arrange) → I / three / books / have', words:['I','have','three','books'], answer:'I have three books'},
  {type:'builder', q:'(arrange) → She / two / sisters / has', words:['She','has','two','sisters'], answer:'She has two sisters'},
  {type:'builder', q:'(arrange) → We / no / money / have', words:['We','have','no','money'], answer:'We have no money'},

  /* Match the Pairs (5) -- each is a question (scoring distributed across pairs) */
  {type:'match', q:'Match subject to correct form (present/past)', pairs:[
    {left:'I', right:'have'}, {left:'He', right:'has'}, {left:'They', right:'have'}, {left:'She', right:'has'}, {left:'We (past)', right:'had'}
  ]},
  {type:'match', q:'Match subject to correct form', pairs:[
    {left:'I (past)', right:'had'}, {left:'John', right:'has'}, {left:'Cats', right:'have'}, {left:'My friend', right:'has'}, {left:'They (past)', right:'had'}
  ]},
  {type:'match', q:'Match subject to correct form', pairs:[
    {left:'You', right:'have'}, {left:'Mary', right:'has'}, {left:'It', right:'has'}, {left:'Parents', right:'have'}, {left:'I (past)', right:'had'}
  ]},
  {type:'match', q:'Match subject to correct form', pairs:[
    {left:'The dog', right:'has'}, {left:'My siblings', right:'have'}, {left:'She (past)', right:'had'}, {left:'We', right:'have'}, {left:'He (past)', right:'had'}
  ]},
  {type:'match', q:'Match subject to correct form', pairs:[
    {left:'Tom', right:'has'}, {left:'They (past)', right:'had'}, {left:'I', right:'have'}, {left:'Our team', right:'has'}, {left:'Students', right:'have'}
  ]},

  /* Drag to Complete (5) */
  {type:'drag', q:'Fill the blank: She ____ a new phone. It is so costly', blanks:[{text:'She ____ a new phone.It is so costly'}], choices:['have','has','had','having'], a:1},
  {type:'drag', q:'Fill the blank: I ____ two dogs.They are so friendly.', blanks:[{text:'I ____ two dogs.They are so friendly'}], choices:['have','has','had','having'], a:0},
  {type:'drag', q:'Fill the blank: They ____ a big house last year.', blanks:[{text:'They ____ a big house last year.'}], choices:['have','has','had','having'], a:2},
  {type:'drag', q:'Fill the blank: We ____ no time now.', blanks:[{text:'We ____ no time now.'}], choices:['have','has','had','having'], a:0},
  {type:'drag', q:'Fill the blank: He ____ a new idea yesterday.', blanks:[{text:'He ____ a new idea yesterday.'}], choices:['have','has','had','having'], a:2},
];

/* --------------- STATE --------------- */
const TOTAL = QUESTIONS.length; // 20
const POINTS = 5; // per question
const PASS = 75;

let idx = 0;
let score = 0;

/* DOM refs */
const quizArea = document.getElementById('quizArea');
const scoreLabel = document.getElementById('scoreLabel');
const progressLabel = document.getElementById('progressLabel');
const fwCanvas = document.getElementById('fw');

/* helpers */
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function normalize(s){ return String(s||'').trim().toLowerCase().replace(/[.,!?;:]+$/,''); }
function updateMeta(){
  scoreLabel.textContent = `Score: ${score}`;
  progressLabel.textContent = `Q ${Math.min(idx+1, TOTAL)} / ${TOTAL}`;
}

/* advance to next question (auto) */
function advance(delay=800){
  setTimeout(()=> {
    idx++;
    if(idx >= TOTAL){ showFinal(); return; }
    render();
  }, delay);
}

/* render controller */
function render(){
  updateMeta();
  quizArea.innerHTML = '';
  const item = QUESTIONS[idx];
  const box = document.createElement('div'); box.className = 'question-box';
  const header = `<div class="qtext">${escapeHtml(item.q)}</div>`;
  box.innerHTML = header + `<div class="content"></div><div class="feedback"></div>`;
  quizArea.appendChild(box);
  const content = box.querySelector('.content');
  const feedback = box.querySelector('.feedback');

  function setFeedback(msg, ok){
    feedback.textContent = msg;
    feedback.className = 'feedback ' + (ok ? 'ok' : 'bad');
  }

  /* ---------- MCQ ---------- */
  if(item.type === 'mcq'){
    safePlay(S.click);
    const wrap = document.createElement('div'); wrap.className = 'choices';
    item.choices.forEach((ch, i) => {
      const el = document.createElement('button');
      el.className = 'choice';
      el.innerHTML = `<span class="label">${escapeHtml(ch)}</span>`;
      el.addEventListener('click', () => {
        // disable sibling clicks
        wrap.querySelectorAll('.choice').forEach(x => { x.classList.add('disabled'); x.disabled = true; });
        if(i === item.a){
          el.classList.add('correct');
          safePlay(S.ok);
          score += POINTS;
        } else {
          el.classList.add('wrong');
          safePlay(S.bad);
          // reveal correct option
          const correctEl = Array.from(wrap.querySelectorAll('.choice'))[item.a];
          if(correctEl) correctEl.classList.add('correct');
        }
        updateMeta();
        advance();
      }, {once:true});
      wrap.appendChild(el);
    });
    content.appendChild(wrap);
  }

  /* ---------- Builder (sentence rearrange) ---------- */
  else if(item.type === 'builder'){
    safePlay(S.click);
    const info = document.createElement('div'); info.className = 'muted'; info.style.color='var(--muted)'; info.textContent = 'Tap tokens to build sentence. Use Undo if needed. Press Enter to submit.';
    const built = document.createElement('div'); built.className = 'built';
    const bank = document.createElement('div'); bank.className = 'token-bank';
    const ctrl = document.createElement('div');
    const undo = document.createElement('button'); undo.className = 'undo-btn'; undo.textContent = 'Undo';
    ctrl.appendChild(undo);

    // shuffled tokens
    const tokens = shuffle(item.words.slice());
    let builtArr = [];

    tokens.forEach(t => {
      const tk = document.createElement('div'); tk.className = 'token'; tk.textContent = t;
      tk.addEventListener('click', () => {
        if(tk.classList.contains('used')) return;
        safePlay(S.click);
        tk.classList.add('used');
        builtArr.push(t);
        renderBuilt();
        // auto-evaluate when all tokens used
        if(builtArr.length === tokens.length){
          evaluate();
        }
      });
      bank.appendChild(tk);
    });

    function renderBuilt(){
      built.innerHTML = builtArr.map(w => `<div class="token">${escapeHtml(w)}</div>`).join('');
    }

    function evaluate(){
      // candidate string
      const candidate = builtArr.join(' ').replace(/\s([.,!?])/g,'$1').trim();
      if(normalize(candidate) === normalize(item.answer)){
        setFeedback('Correct', true);
        safePlay(S.ok);
        score += POINTS;
      } else {
        setFeedback('Wrong — ' + item.answer, false);
        safePlay(S.bad);
      }
      updateMeta();
      // disable rest
      bank.querySelectorAll('.token').forEach(x => x.classList.add('used'));
      advance(500);
    }

    undo.addEventListener('click', () => {
      const last = builtArr.pop();
      if(!last) return;
      // find corresponding token (reverse order to handle duplicates)
      const bankTokens = Array.from(bank.querySelectorAll('.token')).reverse();
      const found = bankTokens.find(bt => bt.textContent === last && bt.classList.contains('used'));
      if(found) found.classList.remove('used');
      renderBuilt();
    });

    // Enter key submits if there is at least one token placed
    function onEnter(e){
      if(e.key === 'Enter'){
        if(builtArr.length === 0) return;
        evaluate();
        window.removeEventListener('keydown', onEnter);
      }
    }
    window.addEventListener('keydown', onEnter);

    content.appendChild(info);
    content.appendChild(built);
    content.appendChild(bank);
    content.appendChild(ctrl);
  }

  /* ---------- Match (formation) ---------- */
  else if(item.type === 'match'){
    safePlay(S.click);
    const lefts = item.pairs.map(p => p.left);
    const rights = shuffle(item.pairs.map(p => p.right));
    const wrap = document.createElement('div'); wrap.className = 'match-wrap';
    const leftCol = document.createElement('div'); leftCol.className = 'match-col';
    const rightCol = document.createElement('div'); rightCol.className = 'match-col';

    // build left elements
    lefts.forEach((l,i) => {
      const el = document.createElement('div'); el.className = 'match-item left'; el.textContent = l; el.dataset.index = i;
      leftCol.appendChild(el);
    });

    // build right options
    rights.forEach(r => {
      const el = document.createElement('div'); el.className = 'match-item right'; el.textContent = r; el.dataset.val = r;
      rightCol.appendChild(el);
    });

    wrap.appendChild(leftCol); wrap.appendChild(rightCol);
    content.appendChild(wrap);

    let selectedLeft = null;
    let correctCount = 0;
    const totalPairs = item.pairs.length;

    leftCol.querySelectorAll('.left').forEach(li => {
      li.addEventListener('click', () => {
        if(li.classList.contains('matched')) return;
        selectedLeft = Number(li.dataset.index);
        leftCol.querySelectorAll('.left').forEach(x => x.classList.remove('selected'));
        li.classList.add('selected');
        setFeedback('Select matching item on the right', true);
      });
    });

    rightCol.querySelectorAll('.right').forEach(ri => {
      ri.addEventListener('click', () => {
        if(selectedLeft === null){ setFeedback('Select a left item first', false); return; }
        const expected = item.pairs[selectedLeft].right;
        const leftEl = leftCol.querySelector(`.left[data-index="${selectedLeft}"]`);
        if(ri.dataset.val === expected){
          // correct
          ri.classList.add('matched');
          leftEl.classList.add('matched');
          safePlay(S.ok);
          correctCount++;
        } else {
          // wrong (brief)
          ri.classList.add('wrong');
          safePlay(S.bad);
          setTimeout(()=> ri.classList.remove('wrong'), 700);
        }
        // clear selection
        selectedLeft = null;
        leftCol.querySelectorAll('.left').forEach(x => x.classList.remove('selected'));

        // if finished evaluating all pairs (all matched)
        const matchedNow = leftCol.querySelectorAll('.matched').length;
        // If all left items matched OR all right choices used, compute score.
        if(matchedNow >= totalPairs){
          // full marks
          const earned = Math.round((correctCount / totalPairs) * POINTS);
          score += earned;
          updateMeta();
          advance();
        }
      });
    });
  }

  /* ---------- Drag-to-fill ---------- */
  else if(item.type === 'drag'){
    safePlay(S.click);
    // single blank per question (as original)
    const blank = document.createElement('div'); blank.className = 'built'; blank.style.minHeight='44px'; blank.textContent = item.blanks[0].text.replace('____','_____');
    const bank = document.createElement('div'); bank.className = 'token-bank'; bank.style.marginTop='12px';

    item.choices.forEach((ch, i) => {
      const el = document.createElement('div'); el.className = 'token'; el.textContent = ch;
      el.addEventListener('click', () => {
        // fill blank and evaluate immediately
        blank.textContent = item.blanks[0].text.replace('____', ch);
        if(i === item.a){
          safePlay(S.ok);
          score += POINTS;
        } else {
          safePlay(S.bad);
        }
        updateMeta();
        // disable further clicks
        bank.querySelectorAll('.token').forEach(x => x.classList.add('used'));
        advance(700);
      }, {once:true});
      bank.appendChild(el);
    });

    content.appendChild(blank);
    content.appendChild(bank);
  }

  else {
    // unknown type, skip
    advance(200);
  }
}

/* final screen */
function showFinal(){
  quizArea.innerHTML = '';
  updateMeta();
  const box = document.createElement('div'); box.className = 'question-box';
  box.innerHTML = `
    <div style="text-align:center;font-size:2.4rem;color:var(--yellow);font-weight:800;margin-bottom:10px">${score} / ${TOTAL * POINTS}</div>
    <div style="text-align:center;color:var(--muted);margin-bottom:14px">${score >= PASS ? 'Excellent — proceed to next topic' : 'Review and try again to reach 75'}</div>
    <div class="final-actions" id="finalActions"></div>
  `;
  quizArea.appendChild(box);

  const actions = document.getElementById('finalActions');
  if(score >= PASS){
    // fireworks + sound
    runFireworks();
    safePlay(S.fire);
    actions.innerHTML = `
      <button id="nextTopic" style="padding:10px 18px;border-radius:40px;border:none;background:var(--yellow);color:#001f2e;font-weight:800;cursor:pointer">Next Topic</button>
      <button id="homeBtn" style="padding:10px 18px;border-radius:40px;border:none;background:rgba(255,255,255,0.08);color:#fff;font-weight:700;cursor:pointer">Home</button>
    `;
    document.getElementById('nextTopic').addEventListener('click', ()=> location.href = 'lesson10_video.html');
    document.getElementById('homeBtn').addEventListener('click', ()=> location.href = 'index.html');
  } else {
    actions.innerHTML = `
      <button id="tryAgain" style="padding:10px 18px;border-radius:40px;border:none;background:#ff6b6b;color:#fff;font-weight:800;cursor:pointer">Try Again</button>
      <button id="homeBtn2" style="padding:10px 18px;border-radius:40px;border:none;background:rgba(255,255,255,0.08);color:#fff;font-weight:700;cursor:pointer">Home</button>
    `;
    document.getElementById('tryAgain').addEventListener('click', ()=> { idx = 0; score = 0; render(); });
    document.getElementById('homeBtn2').addEventListener('click', ()=> location.href = 'index.html');
  }
}

/* fireworks (canvas) */
function runFireworks(){
  const c = fwCanvas;
  c.style.display = 'block';
  c.width = window.innerWidth;
  c.height = window.innerHeight;
  const ctx = c.getContext('2d');
  const particles = [];

  function spawnBurst(x,y){
    const colors = ['#ffd24d','#6fe7ff','#a58bff','#ff7fa3','#b6ff9c'];
    const n = 40 + Math.floor(Math.random()*40);
    for(let i=0;i<n;i++){
      particles.push({
        x,y,
        vx:(Math.random()-0.5)*(4+Math.random()*6),
        vy:(Math.random()-0.7)*(4+Math.random()*6),
        life:60 + Math.random()*60,
        color:colors[Math.floor(Math.random()*colors.length)],
        size:2 + Math.random()*3
      });
    }
  }

  for(let i=0;i<6;i++){
    spawnBurst(Math.random()*c.width, Math.random()*c.height*0.6);
  }

  function tick(){
    ctx.fillStyle = 'rgba(0,0,0,0.12)';
    ctx.fillRect(0,0,c.width,c.height);
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.life--;
      ctx.globalAlpha = Math.max(0, p.life/100);
      ctx.fillStyle = p.color;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
      if(p.life <= 0) particles.splice(i,1);
    }
    if(particles.length > 0) requestAnimationFrame(tick);
    else setTimeout(()=>{ c.style.display='none'; ctx.clearRect(0,0,c.width,c.height); }, 500);
  }
  tick();
}

/* helpers */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

/* init */
render();

/* keyboard: allow Enter in open builder/fitb to evaluate (handlers are installed per-question) */
/* expose for debugging */
window.QUIZ = { QUESTIONS, runFireworks };

/* prevent audio autoplay issues by a first user click if needed */
document.addEventListener('click', function initAudioOnce(){
  safePlay(S.click);
  document.removeEventListener('click', initAudioOnce);
});

</script>
</body>
</html>
