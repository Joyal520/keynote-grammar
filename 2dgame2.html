<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cloud Glide — Typing Pop</title>

<style>
/* -----------------------------------------------------
   GLOBAL STYLES & BACKGROUND
----------------------------------------------------- */
:root{
  --bg:#021026;
  --glass: rgba(255,255,255,0.06);
  --muted:#9fb6c8;
  --accent:#8be9fd;
  --success:#7ef0a7;
  --danger:#ff7b7b;
  --white: #eef6ff;
}
*{box-sizing:border-box}
html,body{
  height:100%; margin:0;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
  background:#031025;
  color:var(--white);
  overflow:hidden;
}

/* Floating gradient blobs */
.blob{
  position:fixed;
  width:420px; height:420px;
  background:radial-gradient(circle, rgba(0,140,255,0.4), rgba(0,0,0,0));
  filter:blur(140px);
  border-radius:50%;
  animation:blobFloat 18s ease-in-out infinite alternate;
  z-index:-3;
}
.blob:nth-child(1){top:10%; left:5%;}
.blob:nth-child(2){top:60%; right:5%; animation-duration:22s;}
.blob:nth-child(3){top:30%; left:50%; animation-duration:26s;}

@keyframes blobFloat {
  0% { transform:translate(0,0) scale(1); }
  100% { transform:translate(-80px,50px) scale(1.2); }
}

/* HUD ----------------------------------------------------- */
#hud{
  position:fixed; top:14px; left:50%;
  transform:translateX(-50%);
  text-align:center;
  z-index:900;
}
#timer{font-weight:800; color:#ffd76a; font-size:21px}
#score{color:var(--accent); font-weight:700; margin-top:6px}

/* START PAGE ----------------------------------------------------- */
.start-overlay{
  position:fixed; inset:0;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.55);
  backdrop-filter:blur(14px);
  z-index:1000;
}

.start-card{
  width:92%; max-width:780px;
  padding:38px;
  border-radius:20px;
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(20px);
  border:1px solid rgba(255,255,255,0.15);
  box-shadow:0 20px 45px rgba(0,0,0,0.65);
  text-align:center;
  animation:fadeInUp 0.8s ease;
}

@keyframes fadeInUp {
  0% { transform:translateY(40px); opacity:0; }
  100% { transform:translateY(0); opacity:1; }
}

.start-title{
  font-size:44px; font-weight:800;
  color:#8ce0ff;
  margin-bottom:12px;
  text-shadow:0 0 25px rgba(140,230,255,0.5);
}

.start-sub{
  color:var(--muted);
  line-height:1.7;
  max-width:640px;
  margin:0 auto 22px;
}

.sel{
  padding:12px;
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.15);
  color:var(--white);
  border-radius:10px;
  width:200px;
  font-size:16px;
}

/* Buttons ----------------------------------------------------- */
.btn{
  padding:14px 26px;
  font-size:18px;
  border:none;
  border-radius:14px;
  cursor:pointer;
  font-weight:700;
  transition:0.28s;
}
.btn.primary{
  background:linear-gradient(90deg,#00c8ff,#2bd3ff);
  color:#042a32;
  box-shadow:0 0 12px rgba(0,200,255,0.4);
}
.btn.primary:hover{
  transform:translateY(-3px);
  box-shadow:0 0 22px rgba(0,200,255,0.6);
}
.btn.sec{
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.15);
  color:var(--muted);
}
.btn.sec:hover{
  background:rgba(255,255,255,0.1);
}

/* PLAY FIELD ----------------------------------------------------- */
#play{
  position:fixed; inset:0; overflow:hidden;
}

/* CLOUD ----------------------------------------------------- */
.cloud{
  position:absolute;
  border-radius:50px;
  background:linear-gradient(180deg,#fff,#f7fbff);
  padding:10px 26px;
  color:#032;
  font-weight:800;
  box-shadow:0 12px 36px rgba(0,0,0,0.45), inset 0 2px 8px rgba(255,255,255,0.6);
  white-space:nowrap;
  user-select:none;
}

.cloud.pop{
  animation:popcloud 0.4s cubic-bezier(.2,.9,.3,1) forwards;
}
@keyframes popcloud{
  0%{transform:scale(1); opacity:1}
  60%{transform:scale(1.6); opacity:0.95}
  100%{transform:scale(0); opacity:0}
}

/* TYPING UI ----------------------------------------------------- */
#typeUI{
  position:fixed; left:50%; bottom:18px;
  transform:translateX(-50%);
  display:flex; gap:12px; align-items:center;
  background:rgba(255,255,255,0.08);
  padding:14px 18px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,0.15);
  box-shadow:0 10px 24px rgba(0,0,0,0.65);
  z-index:850;
}
#typed{
  padding:12px; font-size:18px;
  width:240px;
  border-radius:10px;
  background:rgba(255,255,255,0.05);
  border:1px solid rgba(255,255,255,0.12);
  color:var(--white);
}

/* END SCREEN ----------------------------------------------------- */
#endOverlay{
  position:fixed; inset:0;
  display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.6); backdrop-filter:blur(10px);
  z-index:2000;
}

.end-card{
  width:92%; max-width:740px; padding:34px;
  border-radius:20px;
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(14px);
  border:1px solid rgba(255,255,255,0.12);
  text-align:center;
  animation:fadeInUp 0.7s ease;
}

#fwCanvas{
  width:420px; height:260px;
  display:block; margin:18px auto;
}

/* Small note */
#note{
  position:fixed; left:14px; bottom:14px;
  color:var(--muted);
  font-size:13px;
}

/* Shake animation for wrong input */
.shake{
  animation:shake .3s;
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-6px)}
  50%{transform:translateX(6px)}
  75%{transform:translateX(-6px)}
  100%{transform:translateX(0)}
}
</style>
</head>
<body>

<!-- Background blobs -->
<div class="blob"></div>
<div class="blob"></div>
<div class="blob"></div>

<!-- HUD -->
<div id="hud">
  <div id="timer">Time: 120</div>
  <div id="score">Score: 0</div>
</div>

<!-- START OVERLAY -->
<div id="startOverlay" class="start-overlay">
  <div class="start-card">
    <div class="start-title">Cloud Glide</div>
    <div class="start-sub">
      Type the word shown on a cloud and press <strong>Enter</strong> to pop it.<br>
      Clouds drift from left to right. Pop as many as you can in 2 minutes.<br><br>
      Difficulty affects cloud count, speed, and word length.<br>
      Music starts when you begin.
    </div>

    <select id="difficulty" class="sel">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
    </select>

    <br><br>

    <button id="readyBtn" class="btn primary">Start Game</button>
    <button id="practiceBtn" class="btn sec">Practice Mode</button>
  </div>
</div>

<!-- END OVERLAY -->
<div id="endOverlay">
  <div class="end-card">
    <div id="endTitle" class="start-title"></div>
    <div id="endText" style="color:var(--muted); margin-bottom:18px;"></div>
    <canvas id="fwCanvas"></canvas>

    <button id="retryBtn" class="btn primary">Retry</button>
    <button id="quitBtn" class="btn sec">Quit</button>
  </div>
</div>

<!-- PLAY FIELD -->
<div id="play"></div>

<!-- TYPING UI -->
<div id="typeUI" style="display:none;">
  <input id="typed" placeholder="Type word & Enter" autocomplete="off">
</div>

<div id="note">No penalty for mistakes • Keep typing</div>

<!-- BACKGROUND MUSIC -->
<audio id="bgMusic" src="soft-background-music-437621.mp3" loop></audio>

<script>
/* ----------------------------------------------------
   JS START — COMPLETE FIXED IMPLEMENTATION
---------------------------------------------------- */

/* WORD POOLS */
const WORDS_3=["cat","sun","sky","pen","car","map","key","cup","bag","fox","log","bed","bat","jar","net","pig","toy","cap","cow","rat","jam","ice","one"];
const WORDS_4=["book","tree","love","time","girl","hand","rain","ship","door","fish","milk","star","play","ball","city","home","road","king","ring","snow","wave"];
const WORDS_5=["apple","house","river","light","heart","sound","cloud","movie","table","chair","water","plant","stone","phone","dream"];
const WORDS_6=["planet","banana","castle","silver","travel","forest","square","pillow","museum","people","flight","garden"];
const WORDS_7=["holiday","kitchen","picture","journey","library","science","monster","weather","building"];

/* DIFFICULTY SETTINGS */
const CONFIG={
  easy:{clouds:2,speedMin:18,speedMax:32,pool:['3','4'],pass:80},
  medium:{clouds:3,speedMin:28,speedMax:52,pool:['progress'],pass:100},
  hard:{clouds:5,speedMin:48,speedMax:88,pool:['4','5','6','7'],pass:120}
};

const ROUND_TIME=120;
const SEGMENT=30;
const POP_POINTS=10;

/* DOM */
const play=document.getElementById('play');
const timerEl=document.getElementById('timer');
const scoreEl=document.getElementById('score');
const typed=document.getElementById('typed');
const typeUI=document.getElementById('typeUI');
const startOverlay=document.getElementById('startOverlay');
const endOverlay=document.getElementById('endOverlay');
const endTitle=document.getElementById('endTitle');
const endText=document.getElementById('endText');
const readyBtn=document.getElementById('readyBtn');
const practiceBtn=document.getElementById('practiceBtn');
const retryBtn=document.getElementById('retryBtn');
const quitBtn=document.getElementById('quitBtn');
const diffSel=document.getElementById('difficulty');
const bgMusic=document.getElementById('bgMusic');
const fwCanvas=document.getElementById('fwCanvas');
const fwCtx=fwCanvas.getContext('2d');

/* STATE */
let clouds=[];
let running=false;
let practice=false;
let difficulty="medium";
let timeLeft=ROUND_TIME;
let timerInt=null;
let score=0;
let audioCtx=null;
let lastFrame=performance.now();

/* AUDIO INITIALIZATION */
function ensureAudio(){
  if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)();
}

/* POP SOUND */
function popSound(){
  ensureAudio();
  const now=audioCtx.currentTime;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type='triangle';
  o.frequency.value=520+Math.random()*180;
  g.gain.value=0.0001;
  o.connect(g); g.connect(audioCtx.destination);
  g.gain.linearRampToValueAtTime(0.12,now+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001,now+0.16);
  o.start(now); o.stop(now+0.22);
}

/* CORRECT CHIME */
function correctChime(){
  ensureAudio();
  const now=audioCtx.currentTime;
  [720,1000].forEach((f,i)=>{
    const o=audioCtx.createOscillator();
    const g=audioCtx.createGain();
    o.type='sine';
    o.frequency.value=f;
    g.gain.value=0.0001;
    o.connect(g); g.connect(audioCtx.destination);
    const t=now+i*0.05;
    g.gain.linearRampToValueAtTime(0.08,t+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.25);
    o.start(t); o.stop(t+0.33);
  });
}

/* MISS SOUND */
function missSound(){
  ensureAudio();
  const now=audioCtx.currentTime;
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type='sine';
  o.frequency.value=160;
  g.gain.value=0.0001;
  o.connect(g); g.connect(audioCtx.destination);
  g.gain.linearRampToValueAtTime(0.06,now+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001,now+0.22);
  o.start(now); o.stop(now+0.28);
}

/* WORD MANAGER */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

class WordManager{
  constructor(){
    this.p={
      '3':shuffle([...WORDS_3]),
      '4':shuffle([...WORDS_4]),
      '5':shuffle([...WORDS_5]),
      '6':shuffle([...WORDS_6]),
      '7':shuffle([...WORDS_7])
    };
  }
  pick(key){
    if(this.p[key].length===0){
      if(key==='3') this.p[key]=shuffle([...WORDS_3]);
      if(key==='4') this.p[key]=shuffle([...WORDS_4]);
      if(key==='5') this.p[key]=shuffle([...WORDS_5]);
      if(key==='6') this.p[key]=shuffle([...WORDS_6]);
      if(key==='7') this.p[key]=shuffle([...WORDS_7]);
    }
    return this.p[key].pop();
  }
  pickProgress(el){
    const seg=Math.floor(el/SEGMENT);
    if(seg===0) return this.pick('3');
    if(seg===1) return this.pick('4');
    if(seg===2) return this.pick('5');
    return this.pick('6');
  }
  pickHard(){
    const keys=['4','4','5','5','6','6','7'];
    return this.pick(keys[Math.floor(Math.random()*keys.length)]);
  }
}
let wordMgr=new WordManager();

/* CREATE CLOUD */
function createCloud(initialX){
  const c=document.createElement('div');
  c.className='cloud';

  const elapsed=ROUND_TIME-timeLeft;
  let word;

  if(difficulty==='easy'){
    const pool=['3','4'];
    word=wordMgr.pick(pool[Math.random()<0.5?'3':'4']);
  } else if(difficulty==='medium'){
    word=wordMgr.pickProgress(elapsed);
  } else {
    word=wordMgr.pickHard();
  }

  c.word=word;
  c.textContent=word;

  const w=Math.max(110,16*word.length+48);
  const h=Math.round(w*0.46);
  c.style.width=w+'px';
  c.style.height=h+'px';
  c.style.lineHeight=h+'px';

  const startX=(initialX!==undefined)?initialX:(-w-Math.random()*250);
  const y=Math.random()*(window.innerHeight-180)+60;
  c._x=startX;
  c._y=y;
  c.style.left=startX+'px';
  c.style.top=y+'px';

  const cfg=CONFIG[difficulty];
  c._speed=Math.random()*(cfg.speedMax-cfg.speedMin)+cfg.speedMin;

  play.appendChild(c);
  clouds.push(c);
}

/* SPAWN INITIAL CLOUDS */
function spawnInitialClouds(){
  clouds.forEach(c=>c.remove());
  clouds=[];
  const count=CONFIG[difficulty].clouds;
  for(let i=0;i<count;i++){
    createCloud(-i*200-Math.random()*200);
  }
}

/* FRAME LOOP */
function frame(now){
  const dt=(now-lastFrame)/1000;
  lastFrame=now;

  clouds.slice().forEach(c=>{
    c._x+=c._speed*dt;
    c.style.left=Math.round(c._x)+'px';
    c.style.top=Math.round(c._y+Math.sin((now+c._x)/1100)*8)+'px';

    if(c._x>window.innerWidth+240){
      c.remove();
      clouds=clouds.filter(x=>x!==c);
      if(running){
        setTimeout(()=>createCloud(-200-Math.random()*240),200+Math.random()*400);
      }
    }
  });

  if(running) requestAnimationFrame(frame);
}

/* SUBMIT TYPED WORD */
function trySubmit(){
  const raw=typed.value.trim().toLowerCase();
  if(!raw) return;

  const found=clouds.find(c=>c.word.toLowerCase()===raw);
  if(found){
    popCloud(found);
    typed.value="";
  }else{
    missSound();
    typed.classList.add('shake');
    setTimeout(()=>typed.classList.remove('shake'),300);
  }
}

/* POP CLOUD */
function popCloud(c){
  popSound();
  correctChime();
  c.classList.add('pop');
  score+=POP_POINTS;
  updateHUD();
  setTimeout(()=>{
    c.remove();
    clouds=clouds.filter(x=>x!==c);
    if(running){
      setTimeout(()=>createCloud(-200-Math.random()*220),180+Math.random()*350);
    }
  },340);
}

/* HUD */
function updateHUD(){
  scoreEl.textContent="Score: "+score;
  timerEl.textContent=practice?"Practice":"Time: "+Math.max(0,timeLeft);
}

/* START ROUND */
function startRound(isPractice){
  practice=isPractice;
  difficulty=diffSel.value;
  ensureAudio();

  try{bgMusic.currentTime=0;bgMusic.play();}catch(e){}

  running=true;
  score=0;
  timeLeft=ROUND_TIME;

  typed.value="";
  typeUI.style.display='flex';
  typed.focus();

  wordMgr=new WordManager();
  spawnInitialClouds();

  lastFrame=performance.now();
  requestAnimationFrame(frame);

  if(!practice){
    clearInterval(timerInt);
    timerInt=setInterval(()=>{
      if(!running) return;
      timeLeft--;
      updateHUD();
      if(timeLeft<=0){
        clearInterval(timerInt);
        endRound(score>=CONFIG[difficulty].pass);
      }
    },1000);
  }else{
    timerEl.textContent="Practice";
  }
}

/* END ROUND */
function endRound(passed){
  running=false;
  clearInterval(timerInt);
  typeUI.style.display='none';

  try{bgMusic.pause();bgMusic.currentTime=0;}catch(e){}

  clouds.forEach(c=>c.remove());
  clouds=[];

  endOverlay.style.display='flex';
  endTitle.textContent=passed?"Level Passed!":"Time Up";
  endText.innerHTML=passed?
    `Great work! You scored <strong>${score}</strong>.`:
    `You scored <strong>${score}</strong>. Needed ${CONFIG[difficulty].pass} points.`;

  if(passed){
    fireworkSound();
    runFireworks();
  }else{
    clearFireworks();
  }
}

/* FIREWORKS */
let fwActive=false;
let particles=[];
function spawnFW(x,y){
  for(let i=0;i<36;i++){
    const angle=Math.random()*Math.PI*2;
    const speed=2+Math.random()*3;
    particles.push({
      x,y,
      vx:Math.cos(angle)*speed,
      vy:Math.sin(angle)*speed,
      life:70
    });
  }
}
function fireworkSound(){
  ensureAudio();
  const now=audioCtx.currentTime;
  [400,560,740,900].forEach((f,i)=>{
    const o=audioCtx.createOscillator();
    const g=audioCtx.createGain();
    o.type='square';
    o.frequency.value=f;
    g.gain.value=0.001;
    o.connect(g); g.connect(audioCtx.destination);
    const t=now+i*0.05;
    g.gain.linearRampToValueAtTime(0.2,t+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001,t+0.3);
    o.start(t); o.stop(t+0.35);
  });
}
function runFireworks(){
  fwActive=true;
  particles=[];
  for(let i=0;i<6;i++){
    setTimeout(()=>{
      spawnFW(Math.random()*fwCanvas.width,Math.random()*fwCanvas.height);
    },i*180);
  }
  requestAnimationFrame(fwLoop);
}
function clearFireworks(){
  fwActive=false;
  particles=[];
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
}
function fwLoop(){
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height);
  particles.forEach(p=>{
    p.vy+=0.05;
    p.x+=p.vx;
    p.y+=p.vy;
    p.life--;
    fwCtx.fillStyle=`rgba(180,220,255,${p.life/70})`;
    fwCtx.beginPath();
    fwCtx.arc(p.x,p.y,3,0,Math.PI*2);
    fwCtx.fill();
  });
  particles=particles.filter(p=>p.life>0);
  if(fwActive || particles.length>0) requestAnimationFrame(fwLoop);
}

/* EVENTS */
typed.addEventListener('keydown',e=>{
  if(e.key==="Enter"){e.preventDefault();trySubmit();}
});
document.addEventListener('pointerdown',()=>{if(running) typed.focus();});

/* START BUTTON */
readyBtn.addEventListener('click',()=>{
  startOverlay.style.display='none';
  startRound(false);
});

/* PRACTICE */
practiceBtn.addEventListener('click',()=>{
  startOverlay.style.display='none';
  startRound(true);
});

/* RETRY */
retryBtn.addEventListener('click',()=>{
  endOverlay.style.display='none';
  startRound(false);
});

/* QUIT */
quitBtn.addEventListener('click',()=>{
  endOverlay.style.display='none';
  window.location.reload();
});

/* FIREWORK CANVAS SCALE */
function resizeFW(){
  const dpr=window.devicePixelRatio||1;
  const rect=fwCanvas.getBoundingClientRect();
  fwCanvas.width=rect.width*dpr;
  fwCanvas.height=rect.height*dpr;
  fwCtx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener('resize',resizeFW);
resizeFW();
</script>

</body>
</html>
