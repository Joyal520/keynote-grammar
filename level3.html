<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Keynote Grammar — Sentence Builder (Universal)</title>
<style>
:root{
  --bg:#0f1629; --panel:#0b1b33; --tile:#1e2a47; --tile-hover:#2b3f64;
  --accent:#ffb800; --accent-2:#00eaff; --text:#ffffff; --muted:#9aa7c7;
  --answer-bg:#ffeb3b; --answer-color:#000;
  --success:#b6ffda; --danger:#ffb3b3;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background:var(--bg); color:var(--text); -webkit-font-smoothing:antialiased;
}
.app{max-width:980px;margin:18px auto;padding:18px}
.header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
.title{font-weight:700;font-size:20px}
.controls{display:flex;gap:8px;align-items:center}
button{font-size:14px;padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
.small{font-size:13px;padding:6px 10px;color:var(--muted)}

/* progress & xp */
#overall-bar{width:100%;height:12px;background:rgba(255,255,255,0.06);border-radius:10px;overflow:hidden;margin:8px 0 18px}
#overall-fill{width:0%;height:100%;background:linear-gradient(90deg,var(--accent-2),var(--accent));transition:width .5s ease}

/* panel */
.panel{background:var(--panel);border-radius:14px;padding:16px;box-shadow:0 8px 30px rgba(2,6,23,0.45)}

/* play area */
.top-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
.progress-text{color:var(--muted);font-size:14px}
.xp-wrap{flex:1;min-width:160px;margin-left:12px}
#xp-bar{width:100%;height:12px;background:rgba(255,255,255,0.04);border-radius:8px;overflow:hidden}
#xp-fill{width:0%;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .4s}

/* stars */
.stars{display:flex;gap:6px;align-items:center}
.star{font-size:22px;color:rgba(255,255,255,0.18);transition:color .25s}
.star.active{color:var(--accent)}

/* bank and answer */
.bank-answer{display:flex;gap:12px;margin-top:14px;flex-wrap:wrap}
.word-bank,.answer-zone{flex:1 1 320px;min-height:140px;border-radius:10px;padding:12px;border:2px dashed rgba(255,255,255,0.04);background:linear-gradient(180deg,rgba(255,255,255,0.015),transparent);position:relative;overflow:auto}
.zone-title{font-size:13px;color:var(--muted);margin-bottom:8px;display:flex;align-items:center;gap:8px}

/* punctuation hint badge */
.punct-badge{font-weight:700;color:var(--accent);background:rgba(255,255,255,0.03);padding:4px 8px;border-radius:8px;font-size:13px}

/* word tiles */
.word-tile{display:inline-flex;align-items:center;justify-content:center;padding:10px 14px;margin:8px 8px 0 0;border-radius:10px;cursor:pointer;background:var(--tile);color:var(--text);font-weight:700;user-select:none;transition:transform .12s ease, background .12s, box-shadow .12s;box-shadow:0 6px 18px rgba(2,6,23,0.28)}
.word-tile:hover{transform:translateY(-6px) scale(1.02);background:var(--tile-hover)}
.word-tile.answer-tile{background:var(--answer-bg)!important;color:var(--answer-color)!important;box-shadow:0 10px 26px rgba(0,0,0,0.22)}
.word-tile.disabled{opacity:0.35;cursor:not-allowed;transform:none;box-shadow:none}
.word-tile.punct { font-weight:900; background: rgba(255,255,255,0.06); color: var(--text); }

/* actions */
.actions{display:flex;gap:10px;margin-top:14px;align-items:center;flex-wrap:wrap}
.btn-primary{background:var(--accent);color:#000;padding:10px 14px;border-radius:10px;font-weight:700}
.btn-ghost{background:rgba(255,255,255,0.03);color:var(--text);padding:8px 12px;border-radius:10px}

/* message */
#message{margin-top:12px;text-align:center;font-size:16px;min-height:22px}

/* confetti canvas */
#confetti-canvas{position:fixed;pointer-events:none;top:0;left:0;width:100%;height:100%;z-index:9999}
/* fireworks */
#fireworks-overlay{position:fixed;pointer-events:none;top:0;left:0;width:100%;height:100%;z-index:10000;display:none}

/* wrong shake */
@keyframes shake{10%,90%{transform:translateX(-1px)}20%,80%{transform:translateX(2px)}30%,50%,70%{transform:translateX(-4px)}40%,60%{transform:translateX(4px)}}
.shake{animation:shake .6s cubic-bezier(.36,.07,.19,.97)}

/* level select */
.level-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-top:12px}
.level-card{background:rgba(255,255,255,0.02);padding:14px;border-radius:10px;text-align:center;cursor:pointer}
.level-card.locked{opacity:0.45;cursor:not-allowed}

/* responsive */
@media (max-width:720px){.bank-answer{flex-direction:column}.word-bank,.answer-zone{width:100%}.top-row{flex-direction:column;align-items:flex-start}.xp-wrap{margin-left:0;width:100%}}
</style>
</head>
<body>
<div class="app" id="appRoot">
  <div class="header">
    <div>
      <div class="title" id="pageTitle">Keynote Grammar</div>
      <div style="font-size:13px;color:var(--muted)" id="pageSubtitle">Sentence Builder — load level via <code>?level=N</code></div>
    </div>

    <div class="controls">
      <button id="homeBtn" class="btn-ghost">Home</button>
      <button id="resetBtn" class="btn-ghost">Reset</button>
      <button id="soundToggle" class="btn-ghost">Sound: On</button>
    </div>
  </div>

  <div id="overall-bar"><div id="overall-fill"></div></div>

  <div class="panel" id="mainPanel">
    <!-- dynamic content -->
  </div>
</div>

<canvas id="confetti-canvas"></canvas>
<canvas id="fireworks-overlay"></canvas>

<!-- optional click sound - place rightclick.mp3 in same folder or remove audio usage -->
<audio id="clickSound" src="rightclick.mp3" preload="auto"></audio>

<script>
/* ========================================================================
   QUIZ DATA: Edit ONLY inside QUIZ_DATA. Each level contains `subLevels`,
   each subLevel is an array of 10 question objects:
     { scrambled: [...tokens...], answer: "Correct sentence.", type: "positive|yesno|wh|imperative" }
   ======================================================================== */
const QUIZ_DATA = {
  1: { // Level 1: 3-word sentences (examples)
    level: 1,
    sentenceLength: 3,
    subLevels: [
      [
        { scrambled:["i","eat","rice"], answer:"I eat rice.", type:"positive" },
        { scrambled:["she","has","a pen"], answer:"She has a pen.", type:"positive" },
        { scrambled:["do","you","run"], answer:"Do you run?", type:"yesno" },
        { scrambled:["eat","your","food"], answer:"Eat your food.", type:"imperative" },
        { scrambled:["where","is","mom"], answer:"Where is mom?", type:"wh" },
        { scrambled:["he","sleeps","now"], answer:"He sleeps now.", type:"positive" },
        { scrambled:["are","they","here"], answer:"Are they here?", type:"yesno" },
        { scrambled:["pick","the","pen"], answer:"Pick the pen.", type:"imperative" },
        { scrambled:["what","is","that"], answer:"What is that?", type:"wh" },
        { scrambled:["i","love","icecream"], answer:"I love ice cream.", type:"positive" }
      ]
    ]
  },

  2: { // Level 2: 4-word sentences (from your earlier set)
    level: 2,
    sentenceLength: 4,
    subLevels: [
      [
        { scrambled:["i","am","eating","rice"], answer:"I am eating rice.", type:"positive" },
        { scrambled:["she","is","reading","books"], answer:"She is reading books.", type:"positive" },
        { scrambled:["they","are","playing","games"], answer:"They are playing games.", type:"positive" },
        { scrambled:["we","are","learning","today"], answer:"We are learning today.", type:"positive" },
        { scrambled:["he","is","watching","tv"], answer:"He is watching TV.", type:"positive" },
        { scrambled:["i","will","finish","homework"], answer:"I will finish homework.", type:"positive" },
        { scrambled:["she","bought","a","book"], answer:"She bought a book.", type:"positive" },
        { scrambled:["they","found","the","cat"], answer:"They found the cat.", type:"positive" },
        { scrambled:["we","made","a","cake"], answer:"We made a cake.", type:"positive" },
        { scrambled:["he","opened","the","box"], answer:"He opened the box.", type:"positive" }
      ],
      [
        { scrambled:["are","you","coming","today"], answer:"Are you coming today?", type:"yesno" },
        { scrambled:["do","they","like","pizza"], answer:"Do they like pizza?", type:"yesno" },
        { scrambled:["does","she","know","him"], answer:"Does she know him?", type:"yesno" },
        { scrambled:["is","it","raining","now"], answer:"Is it raining now?", type:"yesno" },
        { scrambled:["will","you","help","me"], answer:"Will you help me?", type:"yesno" },
        { scrambled:["have","you","seen","this"], answer:"Have you seen this?", type:"yesno" },
        { scrambled:["are","they","at","home"], answer:"Are they at home?", type:"yesno" },
        { scrambled:["do","we","start","now"], answer:"Do we start now?", type:"yesno" },
        { scrambled:["did","he","call","you"], answer:"Did he call you?", type:"yesno" },
        { scrambled:["can","you","open","door"], answer:"Can you open the door?", type:"yesno" }
      ],
      [
        { scrambled:["where","are","you","going"], answer:"Where are you going?", type:"wh" },
        { scrambled:["what","did","she","buy"], answer:"What did she buy?", type:"wh" },
        { scrambled:["who","is","at","door"], answer:"Who is at the door?", type:"wh" },
        { scrambled:["when","will","we","meet"], answer:"When will we meet?", type:"wh" },
        { scrambled:["why","is","he","late"], answer:"Why is he late?", type:"wh" },
        { scrambled:["which","one","do","you"], answer:"Which one do you?", type:"wh" },
        { scrambled:["how","did","they","come"], answer:"How did they come?", type:"wh" },
        { scrambled:["whose","book","is","this"], answer:"Whose book is this?", type:"wh" },
        { scrambled:["what","are","you","doing"], answer:"What are you doing?", type:"wh" },
        { scrambled:["where","did","you","go"], answer:"Where did you go?", type:"wh" }
      ],
      [
        { scrambled:["please","open","the","door"], answer:"Please open the door.", type:"imperative" },
        { scrambled:["wash","your","hands","now"], answer:"Wash your hands now.", type:"imperative" },
        { scrambled:["bring","me","that","book"], answer:"Bring me that book.", type:"imperative" },
        { scrambled:["sit","down","and","listen"], answer:"Sit down and listen.", type:"imperative" },
        { scrambled:["turn","off","the","light"], answer:"Turn off the light.", type:"imperative" },
        { scrambled:["finish","your","meal","quickly"], answer:"Finish your meal quickly.", type:"imperative" },
        { scrambled:["write","the","answer","now"], answer:"Write the answer now.", type:"imperative" },
        { scrambled:["close","the","window","please"], answer:"Close the window please.", type:"imperative" },
        { scrambled:["bring","the","bags","here"], answer:"Bring the bags here.", type:"imperative" },
        { scrambled:["stand","up","and","speak"], answer:"Stand up and speak.", type:"imperative" }
      ],
      [
        { scrambled:["she","is","very","kind"], answer:"She is very kind.", type:"positive" },
        { scrambled:["do","you","want","tea"], answer:"Do you want tea?", type:"yesno" },
        { scrambled:["where","is","my","pen"], answer:"Where is my pen?", type:"wh" },
        { scrambled:["please","pass","the","salt"], answer:"Please pass the salt.", type:"imperative" },
        { scrambled:["they","bought","a","car"], answer:"They bought a car.", type:"positive" },
        { scrambled:["will","he","come","soon"], answer:"Will he come soon?", type:"yesno" },
        { scrambled:["what","did","you","say"], answer:"What did you say?", type:"wh" },
        { scrambled:["pick","up","the","keys"], answer:"Pick up the keys.", type:"imperative" },
        { scrambled:["we","found","new","home"], answer:"We found a new home.", type:"positive" },
        { scrambled:["can","you","play","piano"], answer:"Can you play the piano?", type:"yesno" }
      ]
    ]
  },

  3: { // Level 3: 5-word sentences (from your earlier set)
    level: 3,
    sentenceLength: 5,
    subLevels: [
      [
        { scrambled:["i","am","reading","a","book"], answer:"I am reading a book.", type:"positive" },
        { scrambled:["she","is","making","a","cake"], answer:"She is making a cake.", type:"positive" },
        { scrambled:["they","are","playing","football","today"], answer:"They are playing football today.", type:"positive" },
        { scrambled:["we","will","meet","at","noon"], answer:"We will meet at noon.", type:"positive" },
        { scrambled:["he","is","fixing","the","car"], answer:"He is fixing the car.", type:"positive" },
        { scrambled:["i","can","see","the","bird"], answer:"I can see the bird.", type:"positive" },
        { scrambled:["she","brought","her","new","bag"], answer:"She brought her new bag.", type:"positive" },
        { scrambled:["they","found","a","lost","cat"], answer:"They found a lost cat.", type:"positive" },
        { scrambled:["we","drank","coffee","after","class"], answer:"We drank coffee after class.", type:"positive" },
        { scrambled:["he","wants","to","learn","music"], answer:"He wants to learn music.", type:"positive" }
      ],
      [
        { scrambled:["are","you","going","to","school"], answer:"Are you going to school?", type:"yesno" },
        { scrambled:["do","they","want","to","join"], answer:"Do they want to join?", type:"yesno" },
        { scrambled:["will","she","come","to","party"], answer:"Will she come to the party?", type:"yesno" },
        { scrambled:["have","you","seen","my","keys"], answer:"Have you seen my keys?", type:"yesno" },
        { scrambled:["did","he","bring","the","book"], answer:"Did he bring the book?", type:"yesno" },
        { scrambled:["can","you","help","me","please"], answer:"Can you help me please?", type:"yesno" },
        { scrambled:["are","they","ready","for","test"], answer:"Are they ready for the test?", type:"yesno" },
        { scrambled:["could","you","open","the","door"], answer:"Could you open the door?", type:"yesno" },
        { scrambled:["does","she","like","that","song"], answer:"Does she like that song?", type:"yesno" },
        { scrambled:["should","we","start","right","now"], answer:"Should we start right now?", type:"yesno" }
      ],
      [
        { scrambled:["where","did","you","leave","it"], answer:"Where did you leave it?", type:"wh" },
        { scrambled:["what","are","they","doing","now"], answer:"What are they doing now?", type:"wh" },
        { scrambled:["who","will","attend","the","meeting"], answer:"Who will attend the meeting?", type:"wh" },
        { scrambled:["when","are","we","going","home"], answer:"When are we going home?", type:"wh" },
        { scrambled:["why","did","she","leave","early"], answer:"Why did she leave early?", type:"wh" },
        { scrambled:["which","book","do","you","prefer"], answer:"Which book do you prefer?", type:"wh" },
        { scrambled:["how","did","they","solve","that"], answer:"How did they solve that?", type:"wh" },
        { scrambled:["whose","phone","is","on","table"], answer:"Whose phone is on the table?", type:"wh" },
        { scrambled:["what","time","does","class","start"], answer:"What time does class start?", type:"wh" },
        { scrambled:["where","have","you","been","today"], answer:"Where have you been today?", type:"wh" }
      ],
      [
        { scrambled:["please","bring","me","a","glass"], answer:"Please bring me a glass.", type:"imperative" },
        { scrambled:["wash","your","hands","before","eating"], answer:"Wash your hands before eating.", type:"imperative" },
        { scrambled:["sit","quietly","and","read","book"], answer:"Sit quietly and read the book.", type:"imperative" },
        { scrambled:["turn","off","the","lights","please"], answer:"Turn off the lights please.", type:"imperative" },
        { scrambled:["make","sure","you","finish","work"], answer:"Make sure you finish the work.", type:"imperative" },
        { scrambled:["write","your","name","on","paper"], answer:"Write your name on paper.", type:"imperative" },
        { scrambled:["bring","the","box","to","me"], answer:"Bring the box to me.", type:"imperative" },
        { scrambled:["close","the","door","very","silently"], answer:"Close the door very silently.", type:"imperative" },
        { scrambled:["help","your","friend","with","homework"], answer:"Help your friend with homework.", type:"imperative" },
        { scrambled:["stand","in","line","and","wait"], answer:"Stand in line and wait.", type:"imperative" }
      ],
      [
        { scrambled:["i","think","he","is","right"], answer:"I think he is right.", type:"positive" },
        { scrambled:["do","you","remember","this","place"], answer:"Do you remember this place?", type:"yesno" },
        { scrambled:["where","did","they","hide","it"], answer:"Where did they hide it?", type:"wh" },
        { scrambled:["please","tell","me","the","truth"], answer:"Please tell me the truth.", type:"imperative" },
        { scrambled:["they","are","going","to","school"], answer:"They are going to school.", type:"positive" },
        { scrambled:["will","you","be","there","today"], answer:"Will you be there today?", type:"yesno" },
        { scrambled:["what","did","she","just","say"], answer:"What did she just say?", type:"wh" },
        { scrambled:["bring","those","files","to","me"], answer:"Bring those files to me.", type:"imperative" },
        { scrambled:["we","should","start","the","project"], answer:"We should start the project.", type:"positive" },
        { scrambled:["can","you","solve","this","problem"], answer:"Can you solve this problem?", type:"yesno" }
      ]
    ]
  },

  4: { // Level 4: 6-word sentences (sample)
    level: 4,
    sentenceLength: 6,
    subLevels: [
      [
        { scrambled:["i","have","never","seen","this","before"], answer:"I have never seen this before.", type:"positive" },
        { scrambled:["she","bought","a","very","nice","dress"], answer:"She bought a very nice dress.", type:"positive" },
        { scrambled:["they","are","going","to","visit","today"], answer:"They are going to visit today.", type:"positive" },
        { scrambled:["we","must","finish","this","project","soon"], answer:"We must finish this project soon.", type:"positive" },
        { scrambled:["he","has","cleaned","his","room","already"], answer:"He has cleaned his room already.", type:"positive" },
        { scrambled:["can","you","please","open","the","door"], answer:"Can you please open the door?", type:"yesno" },
        { scrambled:["will","you","come","with","me","tomorrow"], answer:"Will you come with me tomorrow?", type:"yesno" },
        { scrambled:["where","did","you","put","the","keys"], answer:"Where did you put the keys?", type:"wh" },
        { scrambled:["please","put","these","books","on","table"], answer:"Please put these books on the table.", type:"imperative" },
        { scrambled:["do","they","know","how","to","swim"], answer:"Do they know how to swim?", type:"yesno" }
      ],
      // 4 more sublevels (short samples)
      [
        { scrambled:["she","wants","to","learn","to","dance"], answer:"She wants to learn to dance.", type:"positive" },
        { scrambled:["why","are","you","looking","at","me"], answer:"Why are you looking at me?", type:"wh" },
        { scrambled:["please","be","quiet","during","the","movie"], answer:"Please be quiet during the movie.", type:"imperative" },
        { scrambled:["we","have","finished","our","homework","already"], answer:"We have finished our homework already.", type:"positive" },
        { scrambled:["can","you","bring","me","some","water"], answer:"Can you bring me some water?", type:"yesno" },
        { scrambled:["what","did","you","say","a","moment"], answer:"What did you say a moment ago?", type:"wh" },
        { scrambled:["they","sent","the","invitation","yesterday"], answer:"They sent the invitation yesterday.", type:"positive" },
        { scrambled:["put","the","phone","on","the","table"], answer:"Put the phone on the table.", type:"imperative" },
        { scrambled:["will","she","finish","the","task","soon"], answer:"Will she finish the task soon?", type:"yesno" },
        { scrambled:["how","can","we","solve","this","problem"], answer:"How can we solve this problem?", type:"wh" }
      ],
      [
        { scrambled:["i","forgot","to","bring","my","bag"], answer:"I forgot to bring my bag.", type:"positive" },
        { scrambled:["do","you","want","another","slice","please"], answer:"Do you want another slice please?", type:"yesno" },
        { scrambled:["when","will","they","arrive","at","school"], answer:"When will they arrive at school?", type:"wh" },
        { scrambled:["tell","me","the","truth","right","now"], answer:"Tell me the truth right now.", type:"imperative" },
        { scrambled:["she","left","the","books","on","desk"], answer:"She left the books on the desk.", type:"positive" },
        { scrambled:["can","we","start","the","meeting","now"], answer:"Can we start the meeting now?", type:"yesno" },
        { scrambled:["which","route","did","you","take","today"], answer:"Which route did you take today?", type:"wh" },
        { scrambled:["please","hand","me","that","red","pen"], answer:"Please hand me that red pen.", type:"imperative" },
        { scrambled:["we","should","check","the","answers","again"], answer:"We should check the answers again.", type:"positive" },
        { scrambled:["did","he","send","the","email","today"], answer:"Did he send the email today?", type:"yesno" }
      ],
      [
        { scrambled:["they","have","already","left","the","building"], answer:"They have already left the building.", type:"positive" },
        { scrambled:["how","did","you","learn","to","cook"], answer:"How did you learn to cook?", type:"wh" },
        { scrambled:["close","the","door","and","turn","off"], answer:"Close the door and turn off.", type:"imperative" },
        { scrambled:["will","you","be","able","to","help"], answer:"Will you be able to help?", type:"yesno" },
        { scrambled:["she","took","the","children","to","school"], answer:"She took the children to school.", type:"positive" },
        { scrambled:["what","would","you","like","to","drink"], answer:"What would you like to drink?", type:"wh" },
        { scrambled:["please","leave","the","package","at","door"], answer:"Please leave the package at the door.", type:"imperative" },
        { scrambled:["do","they","have","any","spare","seats"], answer:"Do they have any spare seats?", type:"yesno" },
        { scrambled:["we","must","prepare","for","the","exam"], answer:"We must prepare for the exam.", type:"positive" },
        { scrambled:["where","can","i","find","that","book"], answer:"Where can I find that book?", type:"wh" }
      ]
    ]
  },

  5: { // Level 5: 7-word sentences (sample)
    level: 5,
    sentenceLength: 7,
    subLevels: [
      [
        { scrambled:["i","have","to","finish","my","homework","today"], answer:"I have to finish my homework today.", type:"positive" },
        { scrambled:["could","you","please","close","the","window","now"], answer:"Could you please close the window now?", type:"yesno" },
        { scrambled:["where","did","you","leave","your","school","bag"], answer:"Where did you leave your school bag?", type:"wh" },
        { scrambled:["please","make","sure","to","lock","the","door"], answer:"Please make sure to lock the door.", type:"imperative" },
        { scrambled:["they","will","arrive","at","the","station","soon"], answer:"They will arrive at the station soon.", type:"positive" },
        { scrambled:["what","would","you","do","in","that","case"], answer:"What would you do in that case?", type:"wh" },
        { scrambled:["do","you","want","me","to","help","you"], answer:"Do you want me to help you?", type:"yesno" },
        { scrambled:["she","did","not","tell","me","the","truth"], answer:"She did not tell me the truth.", type:"positive" },
        { scrambled:["bring","everything","you","need","for","the","trip"], answer:"Bring everything you need for the trip.", type:"imperative" },
        { scrambled:["how","can","we","make","this","work","better"], answer:"How can we make this work better?", type:"wh" }
      ],
      // additional sublevels: keep simple variations for demonstration
      [
        { scrambled:["we","have","been","working","on","this","project"], answer:"We have been working on this project.", type:"positive" },
        { scrambled:["will","they","be","available","next","week","end"], answer:"Will they be available next weekend?", type:"yesno" },
        { scrambled:["why","did","you","not","answer","my","call"], answer:"Why did you not answer my call?", type:"wh" },
        { scrambled:["please","take","your","shoes","off","at","door"], answer:"Please take your shoes off at the door.", type:"imperative" },
        { scrambled:["i","wonder","if","she","will","come","today"], answer:"I wonder if she will come today.", type:"positive" },
        { scrambled:["what","time","should","we","meet","on","monday"], answer:"What time should we meet on Monday?", type:"wh" },
        { scrambled:["do","you","remember","the","name","of","place"], answer:"Do you remember the name of the place?", type:"yesno" },
        { scrambled:["they","did","not","finish","their","homework","yet"], answer:"They did not finish their homework yet.", type:"positive" },
        { scrambled:["please","tell","me","exactly","what","happened","there"], answer:"Please tell me exactly what happened there.", type:"imperative" },
        { scrambled:["how","long","will","the","journey","take","today"], answer:"How long will the journey take today?", type:"wh" }
      ],
      [
        { scrambled:["i","don't","think","this","is","a","good"], answer:"I don't think this is a good idea.", type:"positive" },
        { scrambled:["can","you","explain","that","to","me","again"], answer:"Can you explain that to me again?", type:"yesno" },
        { scrambled:["which","one","of","these","should","we","choose"], answer:"Which one of these should we choose?", type:"wh" },
        { scrambled:["please","remind","me","to","call","her","later"], answer:"Please remind me to call her later.", type:"imperative" },
        { scrambled:["they","have","been","to","this","place","before"], answer:"They have been to this place before.", type:"positive" },
        { scrambled:["what","did","you","think","of","the","film"], answer:"What did you think of the film?", type:"wh" },
        { scrambled:["do","we","need","any","special","equipment","today"], answer:"Do we need any special equipment today?", type:"yesno" },
        { scrambled:["she","wants","to","become","a","doctor","later"], answer:"She wants to become a doctor later.", type:"positive" },
        { scrambled:["please","place","your","answer","in","the","box"], answer:"Please place your answer in the box.", type:"imperative" },
        { scrambled:["how","should","we","approach","this","problem","now"], answer:"How should we approach this problem now?", type:"wh" }
      ],
      [
        { scrambled:["we","shouldn't","forget","to","bring","maps","tomorrow"], answer:"We shouldn't forget to bring maps tomorrow.", type:"positive" },
        { scrambled:["could","you","please","show","me","the","way"], answer:"Could you please show me the way?", type:"yesno" },
        { scrambled:["who","else","is","coming","to","the","party"], answer:"Who else is coming to the party?", type:"wh" },
        { scrambled:["please","listen","carefully","to","the","instructions","now"], answer:"Please listen carefully to the instructions now.", type:"imperative" },
        { scrambled:["they","have","planned","to","meet","later","today"], answer:"They have planned to meet later today.", type:"positive" },
        { scrambled:["what","is","the","best","time","to","call"], answer:"What is the best time to call?", type:"wh" },
        { scrambled:["do","you","think","this","will","work","out"], answer:"Do you think this will work out?", type:"yesno" },
        { scrambled:["she","forgot","to","send","the","important","mail"], answer:"She forgot to send the important mail.", type:"positive" },
        { scrambled:["please","check","the","door","is","locked","now"], answer:"Please check the door is locked now.", type:"imperative" },
        { scrambled:["how","many","people","will","attend","the","meeting"], answer:"How many people will attend the meeting?", type:"wh" }
      ]
    ]
  },

  6: { // Level 6: 8-word sentences
    level: 6,
    sentenceLength: 8,
    subLevels: [
      // one sublevel shown; remaining follow similar pattern
      [
        { scrambled:["i","have","been","waiting","for","you","since","morning"], answer:"I have been waiting for you since morning.", type:"positive" },
        { scrambled:["can","you","tell","me","where","it","was","left"], answer:"Can you tell me where it was left?", type:"yesno" },
        { scrambled:["what","are","the","main","points","of","the","plan"], answer:"What are the main points of the plan?", type:"wh" },
        { scrambled:["please","make","sure","all","lights","are","turned","off"], answer:"Please make sure all lights are turned off.", type:"imperative" },
        { scrambled:["they","should","have","completed","this","task","by","now"], answer:"They should have completed this task by now.", type:"positive" },
        { scrambled:["how","did","you","manage","to","finish","everything","so"], answer:"How did you manage to finish everything so quickly?", type:"wh" },
        { scrambled:["do","you","think","we","can","trust","them","now"], answer:"Do you think we can trust them now?", type:"yesno" },
        { scrambled:["please","hand","over","the","documents","to","the","manager"], answer:"Please hand over the documents to the manager.", type:"imperative" },
        { scrambled:["we","will","be","starting","the","project","next","week"], answer:"We will be starting the project next week.", type:"positive" },
        { scrambled:["what","would","you","prefer","for","dinner","tonight"], answer:"What would you prefer for dinner tonight?", type:"wh" }
      ],
      // for brevity remaining sublevels would be similar; you can edit later
      [],[],[]
    ]
  },

  7: { level:7, sentenceLength:9, subLevels: [ [], [], [], [], [] ] },
  8: { level:8, sentenceLength:10, subLevels: [ [], [], [], [], [] ] },
  9: { level:9, sentenceLength:11, subLevels: [ [], [], [], [], [] ] },
  10:{ level:10, sentenceLength:12, subLevels: [ [], [], [], [], [] ] }
};

/* ========================================================================
   ENGINE START: Do not edit code below unless you are changing UX/behaviour.
   Edit only QUIZ_DATA above to change questions.
   ======================================================================== */

/* helpers */
function qs(sel){ return document.querySelector(sel) }
function qsa(sel){ return Array.from(document.querySelectorAll(sel)) }
function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5) }
function clamped(n,min,max){ return Math.max(min,Math.min(max,n)) }

/* engine state & elements */
let engine = null

/* Audio context for tones */
const AudioCtx = window.AudioContext || window.webkitAudioContext
let audioCtx = null
try{ audioCtx = new AudioCtx() }catch(e){ audioCtx = null }
const clickAudio = qs('#clickSound')

/* confetti / fireworks setup */
const confCanvas = qs('#confetti-canvas'), cctx = confCanvas ? confCanvas.getContext('2d') : null
const fwCanvas = qs('#fireworks-overlay'), fwCtx = fwCanvas ? fwCanvas.getContext('2d') : null
function resizeCanvas(){ if(confCanvas){ confCanvas.width = innerWidth; confCanvas.height = innerHeight } if(fwCanvas){ fwCanvas.width = innerWidth; fwCanvas.height = innerHeight } }
window.addEventListener('resize', resizeCanvas); resizeCanvas()
let confetti = [], confRunning=false, fireworks=[], fwRunning=false

function launchConfetti(count=60){
  if(!cctx) return
  confetti = []
  const colors = ['#ffda32','#ff6b6b','#00eaff','#00c2a8','#ffd45e','#7b61ff']
  for(let i=0;i<count;i++) confetti.push({ x: Math.random()*confCanvas.width, y: -Math.random()*confCanvas.height, vx:(Math.random()-0.5)*4, vy:2+Math.random()*6, r:4+Math.random()*8, col: colors[Math.floor(Math.random()*colors.length)], rot: Math.random()*360 })
  if(!confRunning){ confRunning=true; requestAnimationFrame(stepConfetti) }
}
function stepConfetti(){
  if(!cctx) return
  cctx.clearRect(0,0,confCanvas.width,confCanvas.height)
  confetti.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.rot+=p.vx; cctx.save(); cctx.translate(p.x,p.y); cctx.rotate(p.rot*Math.PI/180); cctx.fillStyle=p.col; cctx.fillRect(-p.r/2,-p.r/2,p.r,p.r*0.6); cctx.restore() })
  confetti = confetti.filter(p=>p.y < confCanvas.height + 50)
  if(confetti.length) requestAnimationFrame(stepConfetti); else confRunning=false
}
function spawnFireworksBurst(x=(fwCanvas.width||800)/2, y=(fwCanvas.height||400)/3, count=30){
  if(!fwCtx) return
  for(let i=0;i<count;i++){
    const angle = (Math.PI*2/count)*i
    fireworks.push({ x,y, vx: Math.cos(angle)*(2+Math.random()*4), vy: Math.sin(angle)*(2+Math.random()*4), life:80+Math.floor(Math.random()*60), r:2+Math.random()*3, color: `hsl(${Math.floor(Math.random()*360)},80%,60%)` })
  }
  if(!fwRunning){ fwRunning=true; fwCanvas.style.display='block'; requestAnimationFrame(stepFireworks) }
}
function stepFireworks(){
  if(!fwCtx) return
  fwCtx.clearRect(0,0,fwCanvas.width,fwCanvas.height)
  fireworks.forEach(p=>{ p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.life--; fwCtx.beginPath(); fwCtx.fillStyle = p.color; fwCtx.globalAlpha = Math.max(0,p.life/120); fwCtx.arc(p.x,p.y,p.r,0,Math.PI*2); fwCtx.fill() })
  fireworks = fireworks.filter(p=>p.life>0)
  if(fireworks.length) requestAnimationFrame(stepFireworks); else { fwRunning=false; fwCanvas.style.display='none' }
}

/* Tone functions */
function playTone(freq, type='sine', len=0.12, gain=0.12){
  if(!audioCtx || !engine || !engine.soundOn) return
  const o = audioCtx.createOscillator(), g = audioCtx.createGain()
  o.type = type; o.frequency.value = freq
  g.gain.setValueAtTime(gain, audioCtx.currentTime)
  o.connect(g); g.connect(audioCtx.destination)
  o.start(); setTimeout(()=>{ try{o.stop()}catch(e){} }, len*1000)
}
function playCorrect(){ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); playTone(880,'sine',0.09,0.08); setTimeout(()=>playTone(1100,'sine',0.09,0.06),90); setTimeout(()=>playTone(1320,'sine',0.09,0.05),180) }
function playWrong(){ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); playTone(160,'sawtooth',0.26,0.12) }
function playComplete(){ if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); playTone(660,'triangle',0.09,0.12); setTimeout(()=>playTone(880,'triangle',0.09,0.12),120); setTimeout(()=>playTone(1320,'triangle',0.14,0.12),240) }

/* Utility normalize - remove punctuation, lowercase, compress spaces */
function normalise(s){
  if(!s) return ''
  return s.toLowerCase().replace(/[“”‘’"']/g,'').replace(/[^\w\s\?\.]/g,'').replace(/\s+/g,' ').trim()
}

/* Save/load progress to localStorage */
const STORAGE_KEY = 'keynote-grammar-progress'
function saveProgress(obj){ try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)) }catch(e){} }
function loadProgress(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}') }catch(e){ return {} } }

/* QuizEngine class */
class QuizEngine {
  constructor(levelNumber){
    this.levelNumber = Number(levelNumber) || 1
    if(!QUIZ_DATA[this.levelNumber]) this.levelNumber = 1
    this.data = QUIZ_DATA[this.levelNumber]
    this.totalSubs = (this.data.subLevels || []).length || 0

    // dynamic state
    this.currentSub = 0
    this.questions = []
    this.qIndex = 0
    this.score = 0
    this.xp = 0
    this.bankHistory = [] // stores {tile, originalIndex}
    this.soundOn = true

    this.progress = loadProgress() || {}
    this._restoreProgressIfAny()

    this._renderShell()
    this._bindGlobalButtons()
    this.renderIntroOrStart()
  }

  _restoreProgressIfAny(){
    const p = this.progress[`level${this.levelNumber}`]
    if(p && typeof p.currentSub === 'number') this.currentSub = clamped(p.currentSub,0,this.totalSubs-1)
  }

  _renderShell(){
    const title = qs('#pageTitle'), subtitle = qs('#pageSubtitle')
    title.textContent = `Keynote Grammar — Level ${this.levelNumber}`
    subtitle.textContent = `Sentence Builder — ${this.data.sentenceLength || '?'}-word sentences • Need 8/10 to pass`

    this.mainPanel = qs('#mainPanel')
    // overall progress fill
    this.overallFill = qs('#overall-fill')
    this.updateOverallBar()
  }

  _bindGlobalButtons(){
    qs('#homeBtn').addEventListener('click', ()=> this.showLevelSelect())
    qs('#resetBtn').addEventListener('click', ()=> {
      if(!confirm('Reset saved progress for this level?')) return
      this.progress[`level${this.levelNumber}`] = { currentSub: 0 }
      saveProgress(this.progress)
      this.currentSub = 0
      this.updateOverallBar()
      this.renderIntroOrStart()
      alert('Progress reset for this level.')
    })
    const stBtn = qs('#soundToggle')
    stBtn.addEventListener('click', ()=> { this.soundOn = !this.soundOn; stBtn.textContent = 'Sound: ' + (this.soundOn ? 'On' : 'Off') })
  }

  updateOverallBar(){
    const pct = this.totalSubs ? (this.currentSub / this.totalSubs) * 100 : 0
    if(this.overallFill) this.overallFill.style.width = pct + '%'
  }

  renderIntroOrStart(){
    // if no level parameter was provided show level select, else intro
    const params = new URLSearchParams(location.search)
    const hasLevelParam = params.has('level')
    if(!hasLevelParam){
      this.showLevelSelect()
      return
    }
    this.renderIntro()
  }

  showLevelSelect(){
    // show grid of levels - unlock rules are simple: levels up to completed+1 unlocked
    const saved = loadProgress()
    const maxCompletedLevel = Object.keys(saved).reduce((acc,k)=>{
      const lv = k.replace('level','')|0
      const cs = (saved[k] && saved[k].completed) ? saved[k].completed : -1
      return Math.max(acc, lv)
    }, 0)

    this.mainPanel.innerHTML = `<h2>Select level</h2>
      <div class="level-grid" id="levelGrid"></div>
      <p style="margin-top:12px;color:var(--muted)">Or open this page with <code>?level=N</code>.</p>`

    const grid = qs('#levelGrid')
    for(let i=1;i<=10;i++){
      const card = document.createElement('div')
      card.className = 'level-card'
      card.innerHTML = `<div style="font-weight:700">Level ${i}</div><div style="font-size:13px;color:var(--muted);margin-top:6px">${(QUIZ_DATA[i] && QUIZ_DATA[i].sentenceLength) ? QUIZ_DATA[i].sentenceLength+'-word' : ''}</div>`
      // permit select - user asked for ?level, but we allow click
      card.addEventListener('click', ()=> {
        location.search = '?level=' + i
      })
      grid.appendChild(card)
    }
  }

  renderIntro(){
    this.mainPanel.innerHTML = `
      <div style="display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap">
        <div style="min-width:220px">
          <div style="font-weight:600">Level ${this.levelNumber} — Sub-level <span id="intro-sub-num">${this.currentSub+1}</span></div>
          <div style="color:var(--muted);font-size:13px;margin-top:6px">Each sub-level contains 10 scrambled sentences. Need 8/10 to pass.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="startBtn" class="btn-primary">Start Sub-level</button>
        </div>
      </div>`
    qs('#startBtn').addEventListener('click', ()=> this.startSubLevel())
  }

  startSubLevel(){
    const subs = this.data.subLevels || []
    if(!subs[this.currentSub] || !subs[this.currentSub].length){
      this.mainPanel.innerHTML = `<div style="text-align:center;padding:30px"><div style="font-size:18px;font-weight:700">No data for sub-level ${this.currentSub+1}</div><div style="color:var(--muted);margin-top:8px">Edit QUIZ_DATA to provide questions for this sub-level.</div></div>`
      return
    }
    this.questions = shuffle(subs[this.currentSub]).slice(0,10) // ensure 10
    this.qIndex = 0
    this.score = 0
    this.xp = 0
    this.bankHistory = []
    this._renderGameShell()
    this.renderQuestion()
  }

  _renderGameShell(){
    this.mainPanel.innerHTML = `
      <div class="top-row">
        <div>
          <div id="progressTxt" class="progress-text">Question 1 of 10</div>
          <div style="font-size:13px;color:var(--muted)">Sub-level: <strong id="currentSub">${this.currentSub+1}</strong></div>
        </div>

        <div class="xp-wrap">
          <div style="font-size:13px;color:var(--muted)">XP</div>
          <div id="xp-bar"><div id="xp-fill"></div></div>
        </div>

        <div class="stars" title="Stars">
          <span class="star" id="star1">★</span>
          <span class="star" id="star2">★</span>
          <span class="star" id="star3">★</span>
        </div>
      </div>

      <div class="bank-answer">
        <div class="word-bank" id="wordBank">
          <div class="zone-title">Word Bank <span id="punctHint" class="punct-badge" style="display:none">?</span></div>
          <div id="bankArea"></div>
        </div>

        <div class="answer-zone" id="answerZone">
          <div class="zone-title">Your Answer (click tiles to move)</div>
          <div id="answerArea"></div>
        </div>
      </div>

      <div class="actions">
        <button id="undoBtn" class="btn-ghost">Undo</button>
        <button id="submitBtn" class="btn-primary">Submit Answer</button>
      </div>

      <div id="message"></div>
    `

    this.bankArea = qs('#bankArea')
    this.answerArea = qs('#answerArea')
    this.progressTxt = qs('#progressTxt')
    this.xpFill = qs('#xp-fill')
    this.starEls = [qs('#star1'), qs('#star2'), qs('#star3')]
    this.punctHint = qs('#punctHint')
    this.messageEl = qs('#message')

    qs('#undoBtn').addEventListener('click', ()=> this.undo())
    qs('#submitBtn').addEventListener('click', ()=> this.submitAnswer())

    // ensure audio context resumed on first gesture
    document.addEventListener('click', ()=>{ if(audioCtx && audioCtx.state === 'suspended') audioCtx.resume() }, { once:true })
  }

  renderQuestion(){
    this.messageEl.textContent = ''
    const q = this.questions[this.qIndex]
    if(!q){ return }

    // punctuation hint
    if(q.type === 'yesno' || q.type === 'wh'){ this.punctHint.style.display = 'inline-block'; this.punctHint.textContent='?' } else { this.punctHint.style.display='none' }

    // prepare bank and answer areas
    this.bankArea.innerHTML = ''
    this.answerArea.innerHTML = ''
    this.bankHistory = []

    // map display forms using answer tokens to preserve capitals and 'I' and 'TV'
    const correct = q.answer.trim()
    const correctTokens = correct.replace(/[?!\.]+$/,'').split(/\s+/)

    const findDisplay = (token) => {
      const norm = token.replace(/[^\w]/g,'').toLowerCase()
      for(let w of correctTokens){
        if(w.replace(/[^\w]/g,'').toLowerCase() === norm) return w
      }
      if(norm==='tv') return 'TV'
      if(norm==='i') return 'I'
      return token
    }

    // tiles: scrambled + punctuation
    let tiles = (q.scrambled || []).slice()
    const punct = (q.type === 'yesno' || q.type === 'wh') ? '?' : '.'
    tiles.push(punct)
    tiles = shuffle(tiles)

    tiles.forEach((tok, idx) => {
      const tile = document.createElement('div')
      tile.className = 'word-tile'
      tile.tabIndex = 0

      if(tok === '?' || tok === '.'){
        tile.classList.add('punct')
        tile.textContent = tok
        tile.dataset.word = tok
      } else {
        const display = findDisplay(tok)
        const firstNorm = correctTokens[0] ? correctTokens[0].replace(/[^\w]/g,'').toLowerCase() : ''
        if(tok.replace(/[^\w]/g,'').toLowerCase() === firstNorm){
          tile.textContent = display.length ? display.charAt(0).toUpperCase() + display.slice(1) : display
        } else {
          tile.textContent = display || tok
        }
        tile.dataset.word = tok
      }

      // click handler
      tile.addEventListener('click', () => {
        // play click sound
        if(this.soundOn && clickAudio){ try{ clickAudio.currentTime = 0; clickAudio.play().catch(()=>{}) }catch(e){} }
        this.answerArea.appendChild(tile)
        tile.classList.add('answer-tile')
        this.bankHistory.push({ tile })
      })

      tile.addEventListener('keydown', (ev) => { if(ev.key === 'Enter' || ev.key === ' '){ ev.preventDefault(); tile.click() } })

      this.bankArea.appendChild(tile)
    })

    // update UI counters
    this.progressTxt.textContent = `Question ${this.qIndex+1} of 10`
    qs('#currentSub') && (qs('#currentSub').textContent = this.currentSub+1)
    this.updateStars(this.score)
    this.updateXP()
  }

  undo(){
    if(!this.bankHistory.length) return
    const last = this.bankHistory.pop()
    if(!last || !last.tile) return
    const tile = last.tile
    tile.classList.remove('answer-tile')
    // return to bank area (append is fine)
    this.bankArea.appendChild(tile)
  }

  submitAnswer(){
    const selectedTiles = Array.from(this.answerArea.querySelectorAll('.word-tile'))
    let user = ''
    selectedTiles.forEach(t => {
      const txt = (t.textContent || '').trim()
      if(txt === '?' || txt === '.'){
        user = user.trim() + txt
      } else {
        user += (user.length === 0 ? '' : ' ') + txt
      }
    })
    user = user.replace(/\s+/g,' ').trim()
    const q = this.questions[this.qIndex]
    if(!q) return
    const correct = q.answer.trim()

    // normalised comparison
    if(normalise(user) === normalise(correct)){
      this.score++
      this.xp = clamped(this.xp + 10, 0, 100)
      this.messageEl.textContent = 'Correct! — ' + correct
      this.messageEl.style.color = 'var(--success)'
      playCorrect()
    } else {
      this.messageEl.textContent = 'Wrong — correct: ' + correct
      this.messageEl.style.color = 'var(--danger)'
      playWrong()
      // shake
      this.answerArea.classList.remove('shake'); void this.answerArea.offsetWidth; this.answerArea.classList.add('shake')
    }

    this.updateStars(this.score)
    this.updateXP()

    // next
    this.qIndex++
    setTimeout(()=> {
      if(this.qIndex < 10) this.renderQuestion()
      else this.finishSubLevel()
    }, 520)
  }

  updateXP(){
    if(this.xpFill) this.xpFill.style.width = this.xp + '%'
  }

  updateStars(score){
    const count = score >= 9 ? 3 : score >= 8 ? 2 : score >= 6 ? 1 : 0
    this.starEls.forEach((el,i)=> el.classList.toggle('active', i < count))
  }

  scoreToStars(s){ if(s>=9) return 3; if(s>=8) return 2; if(s>=6) return 1; return 0 }

  finishSubLevel(){
    const passed = this.score >= 8
    // save progress
    this.progress[`level${this.levelNumber}`] = this.progress[`level${this.levelNumber}`] || {}
    this.progress[`level${this.levelNumber}`].currentSub = this.currentSub
    if(passed){
      this.progress[`level${this.levelNumber}`].completed = Math.max(this.progress[`level${this.levelNumber}`].completed || 0, this.currentSub+1)
    }
    saveProgress(this.progress)

    // show completion area
    this.mainPanel.innerHTML = `
      <div style="text-align:center">
        <div style="font-weight:700;font-size:18px">Sub-level complete</div>
        <div style="margin-top:8px;color:var(--muted)">Score: <strong id="finalScore">${this.score}</strong>/10</div>
        <div id="passMsg" style="margin-top:8px;color:var(--muted)">${passed ? 'Passed — well done!' : 'Failed — you need at least 8 correct.'}</div>
        <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
          <button id="nextBtn" class="btn-primary">${passed ? 'Next Sub-level' : 'Retry'}</button>
          <button id="homeBtnLocal" class="btn-ghost">Level Select</button>
        </div>
      </div>
    `
    qs('#homeBtnLocal').addEventListener('click', ()=> this.showLevelSelect())
    qs('#nextBtn').addEventListener('click', ()=> {
      if(!passed){
        // retry same sublevel
        this.startSubLevel()
        return
      }
      this.currentSub++
      this.updateOverallBar()
      if(this.currentSub >= this.totalSubs){
        // level complete
        this.finishLevel()
      } else {
        this.renderIntro()
      }
      // celebration
      playComplete()
      launchConfetti(60)
      spawnFireworksBurst()
    })
  }

  finishLevel(){
    // mark completed
    this.progress[`level${this.levelNumber}`] = this.progress[`level${this.levelNumber}`] || {}
    this.progress[`level${this.levelNumber}`].completed = this.totalSubs
    saveProgress(this.progress)

    this.mainPanel.innerHTML = `<div style="text-align:center;padding:30px">
      <div style="font-size:20px;font-weight:700">LEVEL ${this.levelNumber} COMPLETE</div>
      <div style="color:var(--muted);margin-top:8px">You passed all sub-levels</div>
      <div style="margin-top:12px"><button id="returnHome" class="btn-ghost">Return Home</button></div>
    </div>`
    qs('#returnHome').addEventListener('click', ()=> this.showLevelSelect())
    playComplete(); launchConfetti(100); spawnFireworksBurst()
  }
}

/* Initialize engine based on ?level or show select */
function init(){
  const params = new URLSearchParams(location.search)
  const level = params.get('level') || null
  if(level){
    engine = new QuizEngine(level)
  } else {
    // show level select (engine renders it when created without query param)
    engine = new QuizEngine(1)
    engine.showLevelSelect()
  }
}

window.addEventListener('DOMContentLoaded', init)
</script>
</body>
</html>
